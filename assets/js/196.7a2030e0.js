(window.webpackJsonp=window.webpackJsonp||[]).push([[196],{527:function(a,s,t){"use strict";t.r(s);var e=t(14),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"mkswap-建立和设置swap交换分区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mkswap-建立和设置swap交换分区"}},[a._v("#")]),a._v(" mkswap - 建立和设置SWAP交换分区")]),a._v(" "),s("p",[a._v("mkswap命令 用于在一个文件或者设备上建立交换分区。在建立完之后要使用sawpon命令开始使用这个交换区。最后一个选择性参数指定了交换区的大小，但是这个参数是为了向后兼容设置的，没有使用的必要，一般都将整个文件或者设备作为交换区。")]),a._v(" "),s("p",[a._v("在Linux设备或者文件中创建交换分区，创建完成之后必须使用swapon来使用它。一般在“/etc/fstab”中有一个交换分区列表，这样开机的时候就可以使用它。")]),a._v(" "),s("h2",{attrs:{id:"适用范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#适用范围"}},[a._v("#")]),a._v(" 适用范围")]),a._v(" "),s("div",{staticClass:"svg redhat"},[a._v("RedHat")]),a._v(" "),s("div",{staticClass:"svg rhel"},[a._v("RHEL")]),a._v(" "),s("div",{staticClass:"svg ubuntu"},[a._v("Ubuntu")]),a._v(" "),s("div",{staticClass:"svg centos"},[a._v("CentOS")]),a._v(" "),s("div",{staticClass:"svg debian"},[a._v("Debian")]),a._v(" "),s("div",{staticClass:"svg deepin"},[a._v("Deepin")]),a._v(" "),s("div",{staticClass:"svg suse"},[a._v("SUSE")]),a._v(" "),s("div",{staticClass:"svg opensuse"},[a._v("openSUSE")]),a._v(" "),s("div",{staticClass:"svg fedora"},[a._v("Fedora")]),a._v(" "),s("div",{staticClass:"svg linuxmint"},[a._v("Linux Mint")]),a._v(" "),s("div",{staticClass:"svg alpinelinux"},[a._v("Alpine Linux")]),a._v(" "),s("div",{staticClass:"svg archlinux"},[a._v("Arch Linux")]),a._v(" "),s("h2",{attrs:{id:"语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[a._v("#")]),a._v(" 语法")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-p PSZ"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-L label"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("-U uuid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("  device  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("参数device通常是一个磁盘分区(类似于/dev/sdb7)，但也可以是一个文件。Linux内核不查看分区ID，但是许多安装脚本将假定十六进制类型82(Linux_SWAP)的分区是交换分区。(警告：Solaris也使用此类型。小心不要关闭Solaris分区。)")]),a._v(" "),s("p",[a._v("参数size是多余的，但为了向后兼容性而保留")]),a._v(" "),s("p",[a._v("PSZ参数指定要使用的页大小。指定它几乎是不必要的(甚至是不明智的)，但是某些旧的libc版本是关于页面大小的，所以mkswap有可能弄错了它。症状是后续Swapon失败了，因为没有找到交换签名。PSZ的典型值为4096或8192。")]),a._v(" "),s("h2",{attrs:{id:"选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选项"}},[a._v("#")]),a._v(" 选项")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建交换分区之前，检测坏块。如果有，那么打印出数量。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 强制执行。如果没有此选项，mkswap将拒绝擦除带有分区表的设备上的第一个块或整个磁盘上的第一个块(例如/dec/sda)。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("            "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置页大小，默认4096。一般是不需要指定这个参数的")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" label      "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定一个label，方便swapon使用。只适用于新的风格交换区域")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v1")]),a._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建v1版本的swap分区，2.5内核之后只支持这种的")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" uuid       "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定uuid，默认情况会生成uuid")]),a._v("\n")])])]),s("h2",{attrs:{id:"说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[a._v("#")]),a._v(" 说明")]),a._v(" "),s("p",[a._v("交换头不触及第一个块。引导加载程序或磁盘标签可以在那里，但不建议安装。建议的设置是为Linux交换区域使用单独的分区。mkswap和许多其他类似mkfs的实用程序一样，擦除了第一块，这样就可以删除磁盘上的旧系统。mkswap拒绝擦除带有磁盘标签的设备上的第一个块，或者整个磁盘。")]),a._v(" "),s("p",[a._v("交换区域的最大有用大小取决于体系结构和内核版本，在i386、PPC、m68k、ARM、sparc上为1 GiB、MIPS上为512 MiB、alpha上为128 GiB、sparc64上为3 TiB。对于2.3.3以后的内核来说，没有这样的限制。请注意，在2.1.117之前，内核为每个页面分配了一个字节，而现在它分配了两个字节，因此使用中的交换区域2 GIB可能需要2个MIB内核内存。")]),a._v(" "),s("p",[a._v("目前，Linux允许32个交换区域(这是Linux2.4.10之前的8个)。使用中的区域可以在文件“/proc/swaps”中看到(自2.1.25以来)。mkswap拒绝10页以下的区域。如果您不知道您的机器使用的页面大小，您可能可以使用“cat /proc/cpuinfo”查找它。")]),a._v(" "),s("p",[a._v("若要设置交换文件，必须在使用mkswap初始化该文件之前创建该文件，例如使用以下命令：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dd if=/dev/zero of=swapfile bs=1024 count=65536")]),a._v("\n")])])]),s("p",[a._v("注意，交换文件不能包含任何漏洞(因此，使用cp(1)创建该文件是不可接受的)")]),a._v(" "),s("h2",{attrs:{id:"举例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#举例"}},[a._v("#")]),a._v(" 举例")]),a._v(" "),s("p",[a._v("创建交换分区，指定页大小2048")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@bogon ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(" /dev/sdb4    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#这里指定页大小2048，取代了系统默认的4096")]),a._v("\nUsing user-specified page size "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2048")]),a._v(", instead of the system value "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v("\nSetting up swapspace version "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(", size "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16382")]),a._v(" KiB\nno label, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("UUID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("42f07b0e-0adb-47b6-a906-1209efabb981\n")])])]),s("p",[a._v("创建交换分区，指定页大小4096，指定label")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@bogon ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkswap")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" wj /dev/sdb4   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#笔者当前的系统，不能使用2048大小的页")]),a._v("\nSetting up swapspace version "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(", size "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16380")]),a._v(" KiB\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("LABEL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("wj, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("UUID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("c458a15d-50ee-4e10-a49b-b59add4879d5\n")])])]),s("p",[a._v("使用交换分区")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@bogon ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" /dev/sdb4        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#使用指定的分区")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@bogon ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapon")]),a._v(" –s               "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看分区使用情况")]),a._v("\nFilename       Type       Size     Used   Priority\n/dev/dm-1      partition  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2940920")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-1")]),a._v("\n/dev/sdb4      partition  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16376")]),a._v("    "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-2")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);